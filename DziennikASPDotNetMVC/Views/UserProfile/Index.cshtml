@model DziennikASPDotNetMVC.Models.User

<h1 class="text-center">
    Twój profil
</h1>

<ol class="list-group list-group-flush text-center border mx-auto mt-4" style="width: 50%">
    <li class="list-group-item d-flex justify-content-between align-items-center">
        Imię: @Html.Encode(Model.name)
        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editModal"
                onclick="openEditModal('Imię', '@Model.name', 'name')">
            Edytuj
        </button>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
        Nazwisko: @Html.Encode(Model.surname)
        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editModal"
                onclick="openEditModal('Nazwisko', '@Model.surname', 'surname')">
            Edytuj
        </button>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
        Login: @Html.Encode(Model.login)
        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editModal"
                onclick="openEditModal('Login', '@Model.login', 'login')">
            Edytuj
        </button>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
        <span id="passwordDisplay" style="display: none;">@Html.Encode(Model.password)</span>
        <span id="passwordMask">********</span>
        <button id="togglePasswordBtn" class="btn btn-secondary btn-sm" onclick="togglePassword()" type="button">
            Pokaż
        </button>
        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editModal"
                onclick="openEditModal('Hasło', '@Model.password', 'password')">
            Edytuj
        </button>
    </li>
</ol>

<!-- Modal -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="editForm" action="@Url.Action("EditField", "UserProfile")" method="post" onsubmit="return validatePassword();">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edytuj dane</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="fieldName" name="fieldName" />
                    <div id="defaultField">
                        <label for="newValueField" class="form-label" id="fieldLabel">Nowa wartość:</label>
                        <input type="text" class="form-control" id="newValueField" name="newValue" />
                    </div>
                    <div id="passwordFields" style="display: none;">
                        <div class="mb-3">
                            <label for="newPasswordField" class="form-label">Nowe hasło:</label>
                            <input type="password" class="form-control" id="newPasswordField" name="newPassword" />
                        </div>
                        <div class="mb-3">
                            <label for="confirmPasswordField" class="form-label">Powtórz hasło:</label>
                            <input type="password" class="form-control" id="confirmPasswordField" name="confirmPassword" />
                        </div>
                        <div id="passwordError" style="color: red; display: none;">
                            Hasła muszą być takie same!
                        </div>
                        <div id="passwordSuccess" style="color: green; display: none;">
                            Hasła są takie same!
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Zapisz zmiany</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function openEditModal(label, currentValue, fieldName) {
        document.getElementById('editModalLabel').textContent = `Edytuj ${label}`;
        document.getElementById('fieldName').value = fieldName;

        if (fieldName === 'password') {
            document.getElementById('defaultField').style.display = 'none';
            document.getElementById('passwordFields').style.display = 'block';
            document.getElementById('passwordError').style.display = 'none';
            document.getElementById('passwordSuccess').style.display = 'none';

            // Zresetowanie wartości dla hasła, jeśli jest edytowane
            document.getElementById('newPasswordField').value = '';  // Upewnij się, że pole dla nowego hasła jest puste
            document.getElementById('confirmPasswordField').value = '';  // To samo dla confirmPasswordField

            // Ustawienie newValueField na pusty ciąg w przypadku edycji hasła
            document.getElementById('newValueField').value = ''; // Zawsze ustawiaj pustą wartość w przypadku edytowania hasła
        } else {
            document.getElementById('defaultField').style.display = 'block';
            document.getElementById('passwordFields').style.display = 'none';
            document.getElementById('newValueField').value = currentValue;  // Załadowanie obecnej wartości
        }
    }

    function togglePassword() {
        const passwordDisplay = document.getElementById('passwordDisplay');
        const passwordMask = document.getElementById('passwordMask');
        const passwordBtn = document.getElementById('togglePasswordBtn');
        const isMasked = passwordMask.style.display !== 'none';

        if (isMasked) {
            passwordMask.style.display = 'none';
            passwordDisplay.style.display = 'inline';
            passwordBtn.textContent = 'Ukryj';
        } else {
            passwordMask.style.display = 'inline';
            passwordDisplay.style.display = 'none';
            passwordBtn.textContent = 'Pokaż';
        }
    }

    function validatePassword() {
        const fieldName = document.getElementById('fieldName').value;
        if (fieldName === 'password') {
            const newPassword = document.getElementById('newPasswordField').value;
            const confirmPassword = document.getElementById('confirmPasswordField').value;

            if (newPassword !== confirmPassword) {
                document.getElementById('passwordError').style.display = 'block';
                document.getElementById('passwordSuccess').style.display = 'none';
                return false; // Zatrzymuje wysyłanie formularza, jeśli hasła się różnią
            } else {
                document.getElementById('passwordError').style.display = 'none';
                document.getElementById('passwordSuccess').style.display = 'block';
            }
        }
        return true; // Formularz jest poprawny, więc można go wysłać
    }
</script>